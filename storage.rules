rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /logos/{gymId}/{allPaths=**} {
      // Allow public read access for logos so they can be displayed in the app.
      allow read;
      
      // Allow write access only to the admin of that gym.
      // This rule works by first getting the user's profile from Firestore.
      // The firestore.rules must allow this read to happen.
      allow write: if request.auth != null &&
                      let userData = get(/databases/$(database)/documents/users/$(request.auth.uid)).data;
                      in userData.role == 'gym-admin' && userData.gymId == gymId;
    }
  }
}
