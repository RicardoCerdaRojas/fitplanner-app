rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /logos/{gymId}/{allPaths=**} {
      // Allow public read for logos so they can be displayed in the app.
      allow read;

      // Allow write access only to the admin of that gym.
      // The user must be authenticated.
      // Their profile in Firestore must have role 'gym-admin'.
      // Their gymId in Firestore must match the gymId in the path.
      allow write: if request.auth != null &&
                      get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'gym-admin' &&
                      get(/databases/$(database)/documents/users/$(request.auth.uid)).data.gymId == gymId;
    }
  }
}
